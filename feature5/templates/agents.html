<ul>
    {% for agent in agents %}
    <li>
        <button onclick="startChat({{ agent.id }})">{{ agent.username }}</button>
    </li>
    {% endfor %}
</ul>

<script>
    async function startChat(agentId) {
        const token = localStorage.getItem("access_token");
        const response = await fetch("{{ url_for('chat.create_chat') }}", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "Authorization": "Bearer " + token
            },
            body: new URLSearchParams({ agent_id: agentId })
        });

        if (response.redirected) {
            window.location.href = response.url; // follow redirect to chat room
        }
    }
</script>